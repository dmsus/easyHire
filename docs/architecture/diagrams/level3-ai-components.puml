@startuml Level3_AIComponents
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

title Component Diagram for AI Service

Container(ai_service, "AI Question Service", "Python, FastAPI", "Generates and validates questions")

Component(generation_handler, "Generation Handler", "FastAPI Handler", "Handles question generation requests")
Component(validation_handler, "Validation Handler", "FastAPI Handler", "Validates AI-generated questions")
Component(rag_service, "RAG Service", "Python Service", "Retrieval-Augmented Generation with vector search")
Component(embedding_service, "Embedding Service", "Python Service", "Generates text embeddings for vector DB")
Component(prompt_engine, "Prompt Engine", "Python Service", "Creates optimized prompts for different question types")
Component(quality_scorer, "Quality Scorer", "Python Service", "Scores question quality and difficulty")

ContainerDb(vector_db, "Vector Database", "PostgreSQL + pgvector")

Component(question_embeddings, "Question Embeddings", "pgvector", "Vector storage for question similarity")
Component(competency_embeddings, "Competency Embeddings", "pgvector", "Vector storage for competency mapping")

System_Ext(gemini, "Gemini API", "Google's AI model")
System_Ext(openrouter, "OpenRouter", "Multiple AI models API")

Rel(generation_handler, rag_service, "Uses for context")
Rel(generation_handler, prompt_engine, "Builds prompts")
Rel(rag_service, embedding_service, "Generates embeddings")
Rel(validation_handler, quality_scorer, "Scores questions")
Rel(generation_handler, gemini, "Calls for generation")
Rel(generation_handler, openrouter, "Fallback calls")

Rel(rag_service, question_embeddings, "Queries similar questions")
Rel(embedding_service, question_embeddings, "Stores embeddings")
Rel(embedding_service, competency_embeddings, "Stores embeddings")

Rel(question_embeddings, vector_db, "Stored in")
Rel(competency_embeddings, vector_db, "Stored in")

@enduml
